// var data = {
//         "data": [{
//                     "timestamp": 1609459200000,
//                     "open": 373.88,
//                     "high": 373.88,
//                     "low": 373.88,
//                     "close": 373.88,
//                     "volume": 0
//                 },
//                 {
//                     "timestamp": 1609718400000,
//                     "open": 375.31,
//                     "high": 375.45,
//                     "low": 364.82,
//                     "close": 368.79,
//                     "volume": 110210800
//                 },
//                 {
//                     "timestamp": 1609804800000,
//                     "open": 368.1,
//                     "high": 372.5,
//                     "low": 368.05,
//                     "close": 371.33,
//                     "volume": 66426200
//                 },
//                 {
//                     "timestamp": 1609891200000,
//                     "open": 369.71,
//                     "high": 376.98,
//                     "low": 369.12,
//                     "close": 373.55,
//                     "volume": 107997600
//                 },
//                 {
//                     "timestamp": 1609977600000,
//                     "open": 376.1,
//                     "high": 379.9,
//                     "low": 375.91,
//                     "close": 379.1,
//                     "volume": 68766800
//                 },
//                 {
//                     "timestamp": 1610064000000,
//                     "open": 380.59,
//                     "high": 381.49,
//                     "low": 377.1,
//                     "close": 381.26,
//                     "volume": 71677200
//                 },
//                 {
//                     "timestamp": 1610323200000,
//                     "open": 377.85,
//                     "high": 380.58,
//                     "low": 377.7189,
//                     "close": 378.69,
//                     "volume": 51176700
//                 },
//                 {
//                     "timestamp": 1610409600000,
//                     "open": 378.89,
//                     "high": 379.86,
//                     "low": 376.36,
//                     "close": 378.77,
//                     "volume": 52547700
//                 },
//                 {
//                     "timestamp": 1610496000000,
//                     "open": 378.69,
//                     "high": 380.86,
//                     "low": 377.85,
//                     "close": 379.79,
//                     "volume": 45303600
//                 },
//                 {
//                     "timestamp": 1610582400000,
//                     "open": 380.59,
//                     "high": 381.13,
//                     "low": 378.1,
//                     "close": 378.46,
//                     "volume": 49989100
//                 },
//                 {
//                     "timestamp": 1610668800000,
//                     "open": 376.72,
//                     "high": 377.58,
//                     "low": 373.7,
//                     "close": 375.7,
//                     "volume": 107159900
//                 },
//                 {
//                     "timestamp": 1610928000000,
//                     "open": 375.7,
//                     "high": 375.7,
//                     "low": 375.7,
//                     "close": 375.7,
//                     "volume": 0
//                 },
//                 {
//                     "timestamp": 1611014400000,
//                     "open": 378.34,
//                     "high": 379.23,
//                     "low": 376.75,
//                     "close": 378.65,
//                     "volume": 51095000
//                 },
//                 {
//                     "timestamp": 1611100800000,
//                     "open": 381.11,
//                     "high": 384.79,
//                     "low": 380.69,
//                     "close": 383.89,
//                     "volume": 61836000
//                 },
//                 {
//                     "timestamp": 1611187200000,
//                     "open": 384.49,
//                     "high": 384.95,
//                     "low": 383.25,
//                     "close": 384.24,
//                     "volume": 47899600
//                 },
//                 {
//                     "timestamp": 1611273600000,
//                     "open": 382.25,
//                     "high": 384.1256,
//                     "low": 381.835,
//                     "close": 382.88,
//                     "volume": 52136900
//                 },
//                 {
//                     "timestamp": 1611532800000,
//                     "open": 383.67,
//                     "high": 384.77,
//                     "low": 378.46,
//                     "close": 384.39,
//                     "volume": 70324100
//                 },
//                 {
//                     "timestamp": 1611619200000,
//                     "open": 385.41,
//                     "high": 385.85,
//                     "low": 383.54,
//                     "close": 383.79,
//                     "volume": 42665200
//                 },
//                 {
//                     "timestamp": 1611705600000,
//                     "open": 380.22,
//                     "high": 380.32,
//                     "low": 372.01,
//                     "close": 374.41,
//                     "volume": 123211900
//                 },
//                 {
//                     "timestamp": 1611792000000,
//                     "open": 376.36,
//                     "high": 381.93,
//                     "low": 375.89,
//                     "close": 377.63,
//                     "volume": 94118000
//                 },
//                 {
//                     "timestamp": 1611878400000,
//                     "open": 375.63,
//                     "high": 376.67,
//                     "low": 368.27,
//                     "close": 370.07,
//                     "volume": 126697200
//                 },
//                 {
//                     "timestamp": 1612137600000,
//                     "open": 373.72,
//                     "high": 377.34,
//                     "low": 370.38,
//                     "close": 376.23,
//                     "volume": 75759400
//                 },
//                 {
//                     "timestamp": 1612224000000,
//                     "open": 379.65,
//                     "high": 383.22,
//                     "low": 376.3181,
//                     "close": 381.55,
//                     "volume": 64208500
//                 },
//                 {
//                     "timestamp": 1612310400000,
//                     "open": 382.43,
//                     "high": 383.7,
//                     "low": 380.48,
//                     "close": 381.85,
//                     "volume": 52230900
//                 },
//                 {
//                     "timestamp": 1612396800000,
//                     "open": 382.96,
//                     "high": 386.24,
//                     "low": 381.9655,
//                     "close": 386.19,
//                     "volume": 47087900
//                 },
//                 {
//                     "timestamp": 1612483200000,
//                     "open": 388.2,
//                     "high": 388.47,
//                     "low": 386.1444,
//                     "close": 387.71,
//                     "volume": 48646700
//                 },
//                 {
//                     "timestamp": 1612742400000,
//                     "open": 389.27,
//                     "high": 390.56,
//                     "low": 388.35,
//                     "close": 390.51,
//                     "volume": 38164300
//                 },
//                 {
//                     "timestamp": 1612828800000,
//                     "open": 389.61,
//                     "high": 390.89,
//                     "low": 389.17,
//                     "close": 390.25,
//                     "volume": 35541100
//                 },
//                 {
//                     "timestamp": 1612915200000,
//                     "open": 392.12,
//                     "high": 392.28,
//                     "low": 387.5,
//                     "close": 390.08,
//                     "volume": 59078400
//                 },
//                 {
//                     "timestamp": 1613001600000,
//                     "open": 391.24,
//                     "high": 391.69,
//                     "low": 388.1,
//                     "close": 390.71,
//                     "volume": 42876000
//                 },
//                 {
//                     "timestamp": 1613088000000,
//                     "open": 389.85,
//                     "high": 392.9,
//                     "low": 389.77,
//                     "close": 392.64,
//                     "volume": 50576300
//                 },
//                 {
//                     "timestamp": 1613347200000,
//                     "open": 392.64,
//                     "high": 392.64,
//                     "low": 392.64,
//                     "close": 392.64,
//                     "volume": 0
//                 },
//                 {
//                     "timestamp": 1613433600000,
//                     "open": 393.96,
//                     "high": 394.17,
//                     "low": 391.53,
//                     "close": 392.3,
//                     "volume": 50932700
//                 },
//                 {
//                     "timestamp": 1613520000000,
//                     "open": 390.42,
//                     "high": 392.66,
//                     "low": 389.33,
//                     "close": 392.39,
//                     "volume": 52750400
//                 },
//                 {
//                     "timestamp": 1613606400000,
//                     "open": 389.59,
//                     "high": 391.515,
//                     "low": 387.74,
//                     "close": 390.72,
//                     "volume": 59712700
//                 },
//                 {
//                     "timestamp": 1613692800000,
//                     "open": 392.07,
//                     "high": 392.38,
//                     "low": 389.55,
//                     "close": 390.03,
//                     "volume": 83219200
//                 },
//                 {
//                     "timestamp": 1613952000000,
//                     "open": 387.06,
//                     "high": 389.62,
//                     "low": 386.74,
//                     "close": 387.03,
//                     "volume": 67348400
//                 },
//                 {
//                     "timestamp": 1614038400000,
//                     "open": 384.66,
//                     "high": 388.95,
//                     "low": 380.2,
//                     "close": 387.5,
//                     "volume": 107241900
//                 },
//                 {
//                     "timestamp": 1614124800000,
//                     "open": 386.33,
//                     "high": 392.23,
//                     "low": 385.27,
//                     "close": 391.77,
//                     "volume": 72394400
//                 },
//                 {
//                     "timestamp": 1614211200000,
//                     "open": 390.41,
//                     "high": 391.88,
//                     "low": 380.78,
//                     "close": 382.33,
//                     "volume": 146429000
//                 },
//                 {
//                     "timestamp": 1614297600000,
//                     "open": 384.35,
//                     "high": 385.58,
//                     "low": 378.23,
//                     "close": 380.36,
//                     "volume": 152657700
//                 },
//                 {
//                     "timestamp": 1614556800000,
//                     "open": 385.59,
//                     "high": 390.92,
//                     "low": 380.57,
//                     "close": 389.58,
//                     "volume": 105297000
//                 },
//                 {
//                     "timestamp": 1614643200000,
//                     "open": 389.82,
//                     "high": 390.07,
//                     "low": 386.0,
//                     "close": 386.54,
//                     "volume": 79539300
//                 },
//                 {
//                     "timestamp": 1614729600000,
//                     "open": 385.79,
//                     "high": 386.83,
//                     "low": 381.31,
//                     "close": 381.42,
//                     "volume": 119855900
//                 },
//                 {
//                     "timestamp": 1614816000000,
//                     "open": 381.22,
//                     "high": 384.0,
//                     "low": 371.88,
//                     "close": 376.7,
//                     "volume": 183171300
//                 },
//                 {
//                     "timestamp": 1614902400000,
//                     "open": 380.46,
//                     "high": 384.76,
//                     "low": 372.64,
//                     "close": 383.63,
//                     "volume": 152010000
//                 },
//                 {
//                     "timestamp": 1615161600000,
//                     "open": 384.66,
//                     "high": 387.68,
//                     "low": 381.42,
//                     "close": 381.72,
//                     "volume": 123084700
//                 },
//                 {
//                     "timestamp": 1615248000000,
//                     "open": 385.85,
//                     "high": 389.91,
//                     "low": 381.73,
//                     "close": 387.17,
//                     "volume": 113586000
//                 },
//                 {
//                     "timestamp": 1615334400000,
//                     "open": 389.69,
//                     "high": 391.4,
//                     "low": 388.17,
//                     "close": 389.58,
//                     "volume": 109909700
//                 },
//                 {
//                     "timestamp": 1615420800000,
//                     "open": 392.23,
//                     "high": 395.65,
//                     "low": 391.74,
//                     "close": 393.53,
//                     "volume": 86271500
//                 },
//                 {
//                     "timestamp": 1615507200000,
//                     "open": 392.07,
//                     "high": 394.21,
//                     "low": 391.2,
//                     "close": 394.06,
//                     "volume": 64653500
//                 },
//                 {
//                     "timestamp": 1615766400000,
//                     "open": 394.33,
//                     "high": 396.68,
//                     "low": 392.03,
//                     "close": 396.41,
//                     "volume": 73571900
//                 },
//                 {
//                     "timestamp": 1615852800000,
//                     "open": 397.07,
//                     "high": 397.83,
//                     "low": 395.08,
//                     "close": 395.91,
//                     "volume": 73715200
//                 },
//                 {
//                     "timestamp": 1615939200000,
//                     "open": 394.53,
//                     "high": 398.12,
//                     "low": 393.3,
//                     "close": 397.26,
//                     "volume": 97924400
//                 },
//                 {
//                     "timestamp": 1616025600000,
//                     "open": 394.48,
//                     "high": 396.72,
//                     "low": 390.75,
//                     "close": 391.48,
//                     "volume": 115349100
//                 },
//                 {
//                     "timestamp": 1616112000000,
//                     "open": 389.88,
//                     "high": 391.569,
//                     "low": 387.15,
//                     "close": 389.48,
//                     "volume": 113624400
//                 },
//                 {
//                     "timestamp": 1616371200000,
//                     "open": 390.03,
//                     "high": 394.07,
//                     "low": 389.97,
//                     "close": 392.59,
//                     "volume": 73750300
//                 },
//                 {
//                     "timestamp": 1616457600000,
//                     "open": 391.91,
//                     "high": 393.46,
//                     "low": 388.66,
//                     "close": 389.5,
//                     "volume": 90445500
//                 },
//                 {
//                     "timestamp": 1616544000000,
//                     "open": 391.0,
//                     "high": 392.75,
//                     "low": 387.47,
//                     "close": 387.52,
//                     "volume": 97537100
//                 },
//                 {
//                     "timestamp": 1616630400000,
//                     "open": 385.98,
//                     "high": 390.55,
//                     "low": 383.9,
//                     "close": 389.7,
//                     "volume": 115998100
//                 },
//                 {
//                     "timestamp": 1616716800000,
//                     "open": 390.93,
//                     "high": 396.41,
//                     "low": 390.29,
//                     "close": 395.98,
//                     "volume": 114361800
//                 },
//                 {
//                     "timestamp": 1616976000000,
//                     "open": 394.4,
//                     "high": 396.75,
//                     "low": 392.81,
//                     "close": 395.78,
//                     "volume": 108086200
//                 },
//                 {
//                     "timestamp": 1617062400000,
//                     "open": 394.42,
//                     "high": 395.45,
//                     "low": 393.02,
//                     "close": 394.73,
//                     "volume": 76235000
//                 },
//                 {
//                     "timestamp": 1617148800000,
//                     "open": 395.34,
//                     "high": 398.0,
//                     "low": 395.31,
//                     "close": 396.33,
//                     "volume": 112707500
//                 },
//                 {
//                     "timestamp": 1617235200000,
//                     "open": 398.4,
//                     "high": 400.67,
//                     "low": 398.18,
//                     "close": 400.61,
//                     "volume": 99642100
//                 },
//                 {
//                     "timestamp": 1617321600000,
//                     "open": 400.61,
//                     "high": 400.61,
//                     "low": 400.61,
//                     "close": 400.61,
//                     "volume": 0
//                 },
//                 {
//                     "timestamp": 1617580800000,
//                     "open": 403.46,
//                     "high": 406.94,
//                     "low": 403.38,
//                     "close": 406.36,
//                     "volume": 91684700
//                 },
//                 {
//                     "timestamp": 1617667200000,
//                     "open": 405.76,
//                     "high": 407.24,
//                     "low": 405.4,
//                     "close": 406.12,
//                     "volume": 61833100
//                 },
//                 {
//                     "timestamp": 1617753600000,
//                     "open": 405.94,
//                     "high": 406.96,
//                     "low": 405.45,
//                     "close": 406.59,
//                     "volume": 55727000
//                 },
//                 {
//                     "timestamp": 1617840000000,
//                     "open": 407.93,
//                     "high": 408.58,
//                     "low": 406.93,
//                     "close": 408.52,
//                     "volume": 57840700
//                 },
//                 {
//                     "timestamp": 1617926400000,
//                     "open": 408.39,
//                     "high": 411.67,
//                     "low": 408.26,
//                     "close": 411.49,
//                     "volume": 61082400
//                 },
//                 {
//                     "timestamp": 1618185600000,
//                     "open": 410.85,
//                     "high": 411.93,
//                     "low": 410.2,
//             "close": 411.64,
//             "volume": 56679300
//         },
//         {
//             "timestamp": 1618272000000,
//             "open": 411.53,
//             "high": 413.53,
//             "low": 411.12,
//             "close": 412.86,
//             "volume": 56533900
//         },
//         {
//             "timestamp": 1618358400000,
//             "open": 412.83,
//             "high": 413.96,
//             "low": 410.87,
//             "close": 411.45,
//             "volume": 61579900
//         },
//         {
//             "timestamp": 1618444800000,
//             "open": 413.74,
//             "high": 416.16,
//             "low": 413.69,
//             "close": 415.87,
//             "volume": 60192600
//         },
//         {
//             "timestamp": 1618531200000,
//             "open": 417.25,
//             "high": 417.91,
//             "low": 415.73,
//             "close": 417.26,
//             "volume": 82025100
//         }
//     ]
// };
// data = data.data;

const responsivefy = svg => {
    // get container + svg aspect ratio
    const container = d3.select(svg.node().parentNode),
        width = parseInt(svg.style('width')),
        height = parseInt(svg.style('height')),
        aspect = width / height;

    // get width of container and resize svg to fit it
    const resize = () => {
        var targetWidth = parseInt(container.style('width'));
        svg.attr('width', targetWidth);
        svg.attr('height', Math.round(targetWidth / aspect));
    };

    // add viewBox and preserveAspectRatio properties,
    // and call resize so that svg resizes on inital page load
    svg
        .attr('viewBox', '0 0 ' + width + ' ' + height)
        .attr('perserveAspectRatio', 'xMinYMid')
        .call(resize);

    // to register multiple listeners for same event type,
    // you need to add namespace, i.e., 'click.foo'
    // necessary if you call invoke this function for multiple svgs
    // api docs: https://github.com/mbostock/d3/wiki/Selections#on
    d3.select(window).on('resize.' + container.attr('id'), resize);
};

const drawChart = (data) => {
    const margin = { top: 50, right: 50, bottom: 50, left: 50 };
    const width = window.innerWidth - margin.left - margin.right; // Use the window's width
    const height = (window.innerHeight * 0.8) - margin.top - margin.bottom; // Use the window's height

    // add chart SVG to the page
    const svg = d3
        .select('#chart')
        .append('svg')
        .attr('width', width + margin['left'] + margin['right'])
        .attr('height', height + margin['top'] + margin['bottom'])
        .call(responsivefy)
        .append('g')
        .attr('transform', `translate(${margin['left']}, ${margin['top']})`);

    // create the axes component

    // find data range
    const xMin = d3.min(data, d => {
        return d['timestamp'];
    });

    const xMax = d3.max(data, d => {
        return d['timestamp'];
    });

    const yMin = d3.min(data, d => {
        return d['close'];
    });

    const yMax = d3.max(data, d => {
        return d['close'];
    });

    // scale using range
    const xScale = d3
        .scaleTime()
        .domain([xMin, xMax])
        .range([0, width]);

    const yScale = d3
        .scaleLinear()
        .domain([yMin - 5, yMax])
        .range([height, 0]);

    svg
        .append('g')
        .attr('id', 'xAxis')
        .attr('transform', `translate(0, ${height})`)
        .call(d3.axisBottom(xScale));

    svg
        .append('g')
        .attr('id', 'yAxis')
        // .attr('transform', `translate(${width}, 0)`)
        .call(d3.axisRight(yScale));

    const line = d3
        .line()
        .x(d => {
            return xScale(d['timestamp']);
        })
        .y(d => {
            return yScale(d['close']);
        });

    svg
        .append('path')
        .data([data])
        .style('fill', 'none')
        .attr('id', 'priceChart')
        .attr('stroke', 'steelblue')
        .attr('stroke-width', '1.5')
        .attr('d', line);
}

d3.json('data/spy.json').then(data => {
    drawChart(data);
});

// drawChart(data);